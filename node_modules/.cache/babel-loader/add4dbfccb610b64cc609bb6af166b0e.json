{"ast":null,"code":"import { findElementAncestor } from '../find-element-ancestor/find-element-ancestor.js';\n\nfunction getPreviousIndex(current, elements, loop) {\n  for (let i = current - 1; i >= 0; i -= 1) {\n    if (!elements[i].disabled) {\n      return i;\n    }\n  }\n\n  if (loop) {\n    for (let i = elements.length - 1; i > -1; i -= 1) {\n      if (!elements[i].disabled) {\n        return i;\n      }\n    }\n  }\n\n  return current;\n}\n\nfunction getNextIndex(current, elements, loop) {\n  for (let i = current + 1; i < elements.length; i += 1) {\n    if (!elements[i].disabled) {\n      return i;\n    }\n  }\n\n  if (loop) {\n    for (let i = 0; i < elements.length; i += 1) {\n      if (!elements[i].disabled) {\n        return i;\n      }\n    }\n  }\n\n  return current;\n}\n\nfunction onSameLevel(target, sibling, parentSelector) {\n  return findElementAncestor(target, parentSelector) === findElementAncestor(sibling, parentSelector);\n}\n\nfunction createScopedKeydownHandler(_ref) {\n  let {\n    parentSelector,\n    siblingSelector,\n    onKeyDown,\n    loop = true,\n    activateOnFocus = false,\n    dir = \"rtl\",\n    orientation\n  } = _ref;\n  return event => {\n    var _a;\n\n    onKeyDown == null ? void 0 : onKeyDown(event);\n    const elements = Array.from(((_a = findElementAncestor(event.currentTarget, parentSelector)) == null ? void 0 : _a.querySelectorAll(siblingSelector)) || []).filter(node => onSameLevel(event.currentTarget, node, parentSelector));\n    const current = elements.findIndex(el => event.currentTarget === el);\n\n    const _nextIndex = getNextIndex(current, elements, loop);\n\n    const _previousIndex = getPreviousIndex(current, elements, loop);\n\n    const nextIndex = dir === \"rtl\" ? _previousIndex : _nextIndex;\n    const previousIndex = dir === \"rtl\" ? _nextIndex : _previousIndex;\n\n    switch (event.key) {\n      case \"ArrowRight\":\n        {\n          if (orientation === \"horizontal\") {\n            event.stopPropagation();\n            event.preventDefault();\n            elements[nextIndex].focus();\n            activateOnFocus && elements[nextIndex].click();\n          }\n\n          break;\n        }\n\n      case \"ArrowLeft\":\n        {\n          if (orientation === \"horizontal\") {\n            event.stopPropagation();\n            event.preventDefault();\n            elements[previousIndex].focus();\n            activateOnFocus && elements[previousIndex].click();\n          }\n\n          break;\n        }\n\n      case \"ArrowUp\":\n        {\n          if (orientation === \"vertical\") {\n            event.stopPropagation();\n            event.preventDefault();\n\n            elements[_previousIndex].focus();\n\n            activateOnFocus && elements[_previousIndex].click();\n          }\n\n          break;\n        }\n\n      case \"ArrowDown\":\n        {\n          if (orientation === \"vertical\") {\n            event.stopPropagation();\n            event.preventDefault();\n\n            elements[_nextIndex].focus();\n\n            activateOnFocus && elements[_nextIndex].click();\n          }\n\n          break;\n        }\n\n      case \"Home\":\n        {\n          event.stopPropagation();\n          event.preventDefault();\n          !elements[0].disabled && elements[0].focus();\n          break;\n        }\n\n      case \"End\":\n        {\n          event.stopPropagation();\n          event.preventDefault();\n          const last = elements.length - 1;\n          !elements[last].disabled && elements[last].focus();\n          break;\n        }\n    }\n  };\n}\n\nexport { createScopedKeydownHandler };","map":{"version":3,"mappings":"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","names":["getPreviousIndex","current","elements","loop","i","disabled","length","getNextIndex","onSameLevel","target","sibling","parentSelector","findElementAncestor","createScopedKeydownHandler","siblingSelector","onKeyDown","activateOnFocus","dir","orientation","event","_a","Array","from","currentTarget","querySelectorAll","filter","node","findIndex","el","_nextIndex","_previousIndex","nextIndex","previousIndex","key","stopPropagation","preventDefault","focus","click","last"],"sources":["../../src/create-scoped-keydown-handler/create-scoped-keydown-handler.ts"],"sourcesContent":["import { findElementAncestor } from '../find-element-ancestor/find-element-ancestor';\n\nfunction getPreviousIndex(current: number, elements: HTMLButtonElement[], loop: boolean) {\n  for (let i = current - 1; i >= 0; i -= 1) {\n    if (!elements[i].disabled) {\n      return i;\n    }\n  }\n\n  if (loop) {\n    for (let i = elements.length - 1; i > -1; i -= 1) {\n      if (!elements[i].disabled) {\n        return i;\n      }\n    }\n  }\n\n  return current;\n}\n\nfunction getNextIndex(current: number, elements: HTMLButtonElement[], loop: boolean) {\n  for (let i = current + 1; i < elements.length; i += 1) {\n    if (!elements[i].disabled) {\n      return i;\n    }\n  }\n\n  if (loop) {\n    for (let i = 0; i < elements.length; i += 1) {\n      if (!elements[i].disabled) {\n        return i;\n      }\n    }\n  }\n\n  return current;\n}\n\n/** Validates that target element is on the same level as sibling, used to filter out children that have the same sibling selector */\nfunction onSameLevel(\n  target: HTMLButtonElement,\n  sibling: HTMLButtonElement,\n  parentSelector: string\n) {\n  return (\n    findElementAncestor(target, parentSelector) === findElementAncestor(sibling, parentSelector)\n  );\n}\n\ninterface GetElementsSiblingsInput {\n  /** Selector used to find parent node, e.g. '[role=\"tablist\"]', '.mantine-Text-root' */\n  parentSelector: string;\n\n  /** Selector used to find element siblings, e.g. '[data-tab]' */\n  siblingSelector: string;\n\n  /** Determines whether next/previous indices should loop */\n  loop?: boolean;\n\n  /** Determines which arrow keys will be used */\n  orientation: 'vertical' | 'horizontal';\n\n  /** Text direction */\n  dir?: 'rtl' | 'ltr';\n\n  /** Determines whether element should be clicked when focused with keyboard event */\n  activateOnFocus?: boolean;\n\n  /** External keydown event */\n  onKeyDown?(event: React.KeyboardEvent<HTMLButtonElement>): void;\n}\n\nexport function createScopedKeydownHandler({\n  parentSelector,\n  siblingSelector,\n  onKeyDown,\n  loop = true,\n  activateOnFocus = false,\n  dir = 'rtl',\n  orientation,\n}: GetElementsSiblingsInput) {\n  return (event: React.KeyboardEvent<HTMLButtonElement>) => {\n    onKeyDown?.(event);\n\n    const elements = Array.from(\n      findElementAncestor(event.currentTarget, parentSelector)?.querySelectorAll<HTMLButtonElement>(\n        siblingSelector\n      ) || []\n    ).filter((node) => onSameLevel(event.currentTarget, node, parentSelector));\n\n    const current = elements.findIndex((el) => event.currentTarget === el);\n    const _nextIndex = getNextIndex(current, elements, loop);\n    const _previousIndex = getPreviousIndex(current, elements, loop);\n    const nextIndex = dir === 'rtl' ? _previousIndex : _nextIndex;\n    const previousIndex = dir === 'rtl' ? _nextIndex : _previousIndex;\n\n    switch (event.key) {\n      case 'ArrowRight': {\n        if (orientation === 'horizontal') {\n          event.stopPropagation();\n          event.preventDefault();\n          elements[nextIndex].focus();\n          activateOnFocus && elements[nextIndex].click();\n        }\n\n        break;\n      }\n\n      case 'ArrowLeft': {\n        if (orientation === 'horizontal') {\n          event.stopPropagation();\n          event.preventDefault();\n          elements[previousIndex].focus();\n          activateOnFocus && elements[previousIndex].click();\n        }\n\n        break;\n      }\n\n      case 'ArrowUp': {\n        if (orientation === 'vertical') {\n          event.stopPropagation();\n          event.preventDefault();\n          elements[_previousIndex].focus();\n          activateOnFocus && elements[_previousIndex].click();\n        }\n\n        break;\n      }\n\n      case 'ArrowDown': {\n        if (orientation === 'vertical') {\n          event.stopPropagation();\n          event.preventDefault();\n          elements[_nextIndex].focus();\n          activateOnFocus && elements[_nextIndex].click();\n        }\n\n        break;\n      }\n\n      case 'Home': {\n        event.stopPropagation();\n        event.preventDefault();\n        !elements[0].disabled && elements[0].focus();\n        break;\n      }\n\n      case 'End': {\n        event.stopPropagation();\n        event.preventDefault();\n        const last = elements.length - 1;\n        !elements[last].disabled && elements[last].focus();\n        break;\n      }\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}